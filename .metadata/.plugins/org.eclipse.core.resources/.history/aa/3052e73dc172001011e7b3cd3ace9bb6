package com.example.services;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Map;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.example.entities.Component;
import com.example.entities.InvoiceDetail;
import com.example.entities.InvoiceHeader;
import com.example.repositories.ComponentRepository;
import com.example.repositories.InvoiceDetailRepository;
import com.example.repositories.InvoiceHeaderRepository;
import com.example.repositories.ModelRepository;

import jakarta.transaction.Transactional;

@Service
public class InvoiceHeaderService {
	 @Autowired
	    private InvoiceHeaderRepository invoiceHeaderRepo;

	    @Autowired
	    private InvoiceDetailRepository invoiceDetailRepo;

	    @Autowired
	    private ModelRepository modelRepo;

	    @Autowired
	    private ComponentRepository componentRepo;

    public List<InvoiceHeader> getAllInvoices() {
        return invoiceHeaderRepo.findAll();
    }

    public InvoiceHeader createInvoice(InvoiceHeader invoice) {
        return invoiceHeaderRepo.save(invoice);
    }

    @Transactional
    public InvoiceHeader createInvoice(InvoiceHeader header, List<InvoiceDetail> details) {
        // Save header first
        InvoiceHeader savedHeader = invoiceHeaderRepo.save(header);

        // Save each detail with reference to the saved header
        for (InvoiceDetail detail : details) {
            detail.setInvoice(savedHeader);
            invoiceDetailRepo.save(detail);
        }

        return savedHeader;
    }

    public Optional<InvoiceHeader> getInvoiceById(int invId) {
        return invoiceHeaderRepo.findById(invId);
    }
}
